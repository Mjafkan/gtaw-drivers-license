as<html>

<head>
  <style>
    .wrapper {
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #canvas {
      max-width: 600px;
    }

  </style>
  <title>GTA World: San Andreas Drivers License Generator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">

</head>

<body>
  <div class="wrapper">
    <form id="form" action="javascript:;">
      <div class="container">
        <div class="row">
          <div class="col">
            <div class="mb-3">
              <label for="first-name" class="form-label">First Name</label>
              <input name="first-name" id="first-name" class="form-control form-control-sm" placeholder="John"
                value="Ridley" />
            </div>
            <div class="mb-3">
              <label for="last-name" class="form-label">Last Name</label>
              <input name="last-name" id="last-name" class="form-control form-control-sm" placeholder="Doe"
                value="Foster" />
            </div>
            <div class="mb-3">
              <label for="sex" class="form-label">Sex</label>
              <select class="form-select" id="sex" aria-label="Default select example">
                <option value="Male">Male</option>
                <option value="Female">Female</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="dob" class="dob">Date of Birth</label>
              <input name="dob" id="dob" class="form-control form-control-sm" placeholder="DD/MMM/YYYY"
                value="17/APR/1990" />
            </div>
            <div class="mb-3">
              <label for="hair" class="form-label">Hair Color</label>
              <input name="address-str" id="hair" class="form-control form-control-sm" placeholder="Brown"
                value="Black" />
            </div>
            <div class="mb-3">
              <label for="eye" class="form-label">Eye Color</label>
              <select class="form-select" id="eye" aria-label="Default select example">
                <option value="Brown">Brown</option>
                <option value="Amber">Amber</option>
                <option value="Hazel">Hazel</option>
                <option value="Green">Green</option>
                <option value="Blue">Blue</option>
                <option value="Grey">Grey</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="mb-3">
              <label for="height" class="form-label">Height</label>
              <input name="height" id="height" class="form-control form-control-sm" placeholder="5ft 8in"
                value="5ft 11in" />
            </div>
            <div class="mb-3">
              <label for="weight" class="form-label">Weight</label>
              <input name="weight" id="weight" class="form-control form-control-sm" placeholder="105LBS"
                value="185LBS" />
            </div>
            <div class="mb-3">
              <label for="exp" class="form-label">Licence Expiry Date </label>
              <input name="exp" id="exp" class="form-control form-control-sm" placeholder="26/OCT/2099 14:27"
                value="26/OCT/2099 14:27" />
            </div>
            <div class="mb-3">
              <label for="pic" class="form-label">Passport Photo Link </label>
              <input name="pic" id="pic" class="form-control form-control-sm"
                placeholder="https://i.imgur.com/O3pAxLh.png" value="https://i.imgur.com/O3pAxLh.png" />
            </div>
            <div class="mb-3">
              <label for="sign" class="form-label">Signature Image Link </label>
              <input name="sign" id="sign" class="form-control form-control-sm"
                placeholder="https://i.imgur.com/ssWq9gi.png" value="https://i.imgur.com/wwSq9gi.png" />
            </div>
            <div class="mb-3">
              <label for="background-overlay" class="form-label">Card State</label>
              <select class="form-select" id="background-overlay" aria-label="Default select example">
                <option value="1">Clean</option>
                <option value="2">Dirty 1</option>
                <option value="3">Dirty 2</option>
                <option value="4">Scratched</option>
                <option value="5">Scratched & Dirty</option>
              </select>
            </div>
          </div>
          <div class="col">
            <div class="mb-3">
              <label for="room-num" class="form-label">Room Number</label>
              <input name="room-num" id="room-num" class="form-control form-control-sm" placeholder="1" value="1" />
            </div>
            <div class="mb-3">
              <label for="floor-num" class="form-label">Floor Number</label>
              <input name=floor-num" id="floor-num" class="form-control form-control-sm" placeholder="1" value="2" />
            </div>
            <div class="mb-3">
              <label for="address-num" class="form-label">Building Number</label>
              <input name="address-num" id="address-num" class="form-control form-control-sm" placeholder="1"
                value="123" />
            </div>
            <div class="mb-3">
              <label for="address-str" class="form-label">Street Name</label>
              <input name="address-str" id="address-str" class="form-control form-control-sm"
                placeholder="1 San Andreas Ave" value="Value Street" />
            </div>
            <div class="mb-3">
              <label for="address-dis" class="form-label">District</label>
              <input name="address-dis" id="address-dis" class="form-control form-control-sm" placeholder="Pillbox Hill"
                value="Hawick" />
            </div>
            <div class="mb-3">
              <label for="address-cit" class="form-label">Area</label>
              <select class="form-select" id="address-cit" aria-label="Default select example">
                <option value="Los Santos, San Andreas">City of Los Santos</option>
                <option value="Los Santos County">Los Santos County</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <button type="submit">Create license</button>
    </form>
    <div id="error-message" class="alert alert-danger visually-hidden" role="alert"></div>
    <canvas id="canvas" width="1200" height="752"></canvas>
  </div>
  <script type="module">
    // This function returns a promise, which is an object you can wait for without blocking other CPU work.
    const loadImage = (url) => new Promise((resolve, reject) => {
      // Create an image object.
      const image = new Image()
      // Set the cross-origin mode to anonymous, to avoid issues where we try to load images from a different server.
      image.crossOrigin = 'anonymous'
      // When the image loads, resolve (return the promise) with the image object.
      image.onload = () => resolve(image)
      // If the image encounters an error, reject the promise. This will cause anyone waiting for the promise to get an error.
      image.onerror = reject
      // Set the image source (src) to start the image loading.
      image.src = url
    })

    // Get the canvas element from the page, using it's ID.
    const canvas = document.querySelector('#canvas')
    // Get the 2D context from the canvas element. This is what we'll draw to.
    const context = canvas.getContext('2d')

    const createLicense = async () => {
      const errorComponent = document.querySelector('#error-message')

      if (!errorComponent.classList.contains('visually-hidden')) {
        errorComponent.classList.add('visually-hidden')
      }

      // We'll create an object to hold the license details.
      // This could come from the server, or be filled in from input fields.
      const licenseDetails = {
        exp: document.querySelector('#exp').value,
        ln: document.querySelector('#last-name').value,
        fn: document.querySelector('#first-name').value,
        roonum: document.querySelector('#room-num').value,
        flonum: document.querySelector('#floor-num').value,
        addrnum: document.querySelector('#address-num').value,
        addrstr: document.querySelector('#address-str').value,
        addrdis: document.querySelector('#address-dis').value,
        addrcit: document.querySelector('#address-cit').value,
        class: 'A',
        end: 'None',
        dob: document.querySelector('#dob').value,
        sex: document.querySelector('#sex').value,
        hair: document.querySelector('#hair').value,
        eyes: document.querySelector('#eye').value,
        hgt: document.querySelector('#height').value,
        wgt: document.querySelector('#weight').value,
        sig: document.querySelector('#sign').value,
        pic: document.querySelector('#pic').value,
        backgroundOverlay: document.querySelector('#background-overlay').value,
        iss: '~1'
      }

      //My attempt at an If statement so RM and FL arn't printed if there is no room or floor number.
      //Addresses might have a Room and Floor Number, or just a Room Number, or just an Address umber.

      // Create an empty array. This is basically a list of things - you can add to it using ".push".
      const addressLineOneParts = [];

      // If the room number input is empty, it will actually have the value "" - an empty string.
      // In JavaScript, an empty string is the same as a false value.
      // If the string has anything in it, it will be the same as a true value.
      // Therefore, this if statement says "if there's anything in roonum".
      if (licenseDetails.roonum) {
        // Push the room number into the array of address line one parts.
        addressLineOneParts.push(`RM${licenseDetails.roonum.slice(0, 2)}`)
      }

      // Again, here we're say "if there's anything in flonum"
      if (licenseDetails.flonum) {
        // Push the floor number into the array of address line one parts.
        addressLineOneParts.push(`FL${licenseDetails.flonum.slice(0, 2)}`)
      }

      // We'll finally add another part to the address line 1 - this one isn't conditional.
      addressLineOneParts.push(`${licenseDetails.addrnum} ${licenseDetails.addrstr}`);

      // Now we'll join together the parts we've pushed into the array for address line 1.
      // This avoids us having to add individual commas and spaces between the parts.
      const addressLineOne = addressLineOneParts.join(', ')

      //Next line for when using above If
      //const addressLineOne = `${addrDetails.roomPre}${licenseDetails.roonum.slice(0, 2)}${addrDetails.roomEnd}${addrDetails.flooPre}${licenseDetails.flonum.slice(0, 2)}${addrDetails.flooEnd}${licenseDetails.addrnum} ${licenseDetails.addrstr}`
      //Next line for when not using above If
      //const addressLineOne = `RM${licenseDetails.roonum.slice(0, 2)}, FL${licenseDetails.flonum.slice(0, 2)}, ${licenseDetails.addrnum} ${licenseDetails.addrstr}`
      //Interpolated String. (Mixing strings up)
      const addressLineTwo = `${licenseDetails.addrdis}, ${licenseDetails.addrcit}`
      const licenseId = `|${licenseDetails.exp.slice(-5).replace(':', '')}${licenseDetails.exp.slice(-10, -8)}${licenseDetails.exp.slice(0, 2)}`
      const licenseDd = `${licenseDetails.exp.slice(-10, -6)}/AN${licenseDetails.sex.slice(0, 1)}/${licenseDetails.ln.slice(0, 1)}${licenseDetails.fn.slice(0, 1)}${licenseDetails.dob.slice(-2)}/${licenseDetails.eyes.slice(0, 2)}${licenseDetails.hair.slice(0, 2)}/${licenseDetails.hgt.slice(0, 1)}${licenseDetails.wgt.slice(0, 3)}`

      // The "await" keywork lets us wait until something asynchronous finishes happening. When the thing we're waiting on finishes, our program will continue running.
      const licensePicUrl = licenseDetails.pic

      try {
        licensePhoto = await loadImage(licensePicUrl)
      } catch (error) {
        errorComponent.textContent = 'Could not load submitted photo image. Check the link you have provided is correct and resubmit.'
        errorComponent.classList.remove('visually-hidden')
      }

      const licenseSigUrl = licenseDetails.sig
      let licenseSign

      try {
        licenseSign = await loadImage(licenseSigUrl)
      } catch (error) {
        errorComponent.textContent = 'Could not load submitted signature image. Check the link you have provided is correct and resubmit.'
        errorComponent.classList.remove('visually-hidden')
        return
      }

      const licenseBackground = await loadImage('drivers-licence-colour.png')

      const photoRatio = 440 / licensePhoto.width
      context.drawImage(licensePhoto, 2, 140, licensePhoto.width * photoRatio, licensePhoto.height * photoRatio)

      context.drawImage(licenseBackground, 0, 0)

      const signatureRatio = 500 / licenseSign.width
      context.drawImage(licenseSign, 15, 600, licenseSign.width * signatureRatio, licenseSign.height * signatureRatio)

      // Set the font we want the canvas to use.
      context.font = "Bold 60px Monospace"
      // Set the style that will be used when filling content, such as text or shapes. Red Text.
      context.fillStyle = 'red'

      // Write some text to the canvas, filled with our current canvas fill style.
      // We're writing it to the x & y coordinates passed as the second and third arguments.
      context.fillText(licenseId, 485, 190)
      context.fillText(licenseDetails.exp.slice(0, 11), 490, 270)

      // Make font black
      context.fillStyle = 'black'

      context.fillText(licenseDetails.iss, 1040, 730)

      // We'll make the font smaller for the next few things we write.
      context.font = "Bold 40px Monospace"

      context.fillText(licenseDetails.class, 980, 234)
      context.fillText(licenseDetails.dob, 500, 480)
      context.fillText(licenseDetails.sex.toUpperCase().slice(0, 1), 615, 628)
      context.fillText(licenseDetails.eyes.toUpperCase(), 780, 628)
      context.fillText(licenseDetails.hair.toUpperCase().slice(0, 8), 990, 628)
      context.fillText(licenseDetails.hgt.toUpperCase().slice(0, 8), 620, 665)
      context.fillText(licenseDetails.wgt.toUpperCase(), 915, 665)

      // We want to make this text uppercase, so we call the "toUpperCase" function on it.
      context.fillText(licenseDetails.ln.toUpperCase(), 490, 323)
      context.fillText(licenseDetails.fn.toUpperCase(), 490, 363)
      context.fillText(licenseDetails.end.toUpperCase(), 955, 270)
      context.fillText(licenseDetails.end.toUpperCase(), 505, 523)


      //licenseDd

      // Even smaller text
      context.font = "Bold 35px Monospace"
      context.fillText(addressLineOne.toUpperCase(), 425, 400)
      context.fillText(addressLineTwo.toUpperCase(), 425, 440)
      context.fillText(licenseDd.toUpperCase(), 600, 705)

      // Prefer triple equals over double equals.
      // Triple equals (===) means "strictly the same as", and checks both the type and value of each side.
      // It's safer and less likely to make mistakes.
      // Double equals (==) means "loosely the same as", and will try to change each side to the same type to match.
      // This can give unintended consequences, like a string equalling a number.
      if (licenseDetails.backgroundOverlay === '1') {
        const licenseOverlay = await loadImage('id-clean.png')
        context.drawImage(licenseOverlay, 0, 0)
      }
      if (licenseDetails.backgroundOverlay === '2') {
        const licenseOverlay = await loadImage('id-dirt.png')
        context.drawImage(licenseOverlay, 0, 0)
      }
      if (licenseDetails.backgroundOverlay === '3') {
        const licenseOverlay = await loadImage('id-dirt2.png')
        context.drawImage(licenseOverlay, 0, 0)
      }
      if (licenseDetails.backgroundOverlay === '4') {
        const licenseOverlay = await loadImage('id-scratch.png')
        context.drawImage(licenseOverlay, 0, 0)
      }
      if (licenseDetails.backgroundOverlay === '5') {
        const licenseOverlay = await loadImage('id-scratch-dirt.png')
        context.drawImage(licenseOverlay, 0, 0)
      }
    }

    const form = document.querySelector('#form')
    form.onsubmit = createLicense
  </script>
</body>

</html>
